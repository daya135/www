<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>canvas study</title>
        <script src="../js/ol.js"></script>
        <script src="../js/jquery-1.11.1.min.js"></script>
        <link rel="stylesheet" type="text/css" href="../css/ol.css" />
    </head>

    <body onload="draw()">
        <canvas id="canvas"></canvas>
        <script>
            let line1 = [[0, 300], [300, 0], [600, 300], [300, 600]];
            let line2 = [[0, 0], [300, 0], [300, 300], [0, 300]];
            function draw() {
                var canvas = document.getElementById('canvas');
                if(canvas.getContext) {
                    var ctx = canvas.getContext('2d');
                    canvas.width = 2000;
                    canvas.height = 2000;
                    var img = new Image();
                    img.src = '../img/icon/shanqu.png';
                    img.onload = function() {
                        drawLine2(ctx, [[300, 50], [600, 200]]);
                        drawLine(ctx, [[300, 50], [600, 200]], img);
                        drawLine2(ctx, [[600, 200], [300, 500]]);
                        drawLine(ctx, [[600, 200], [300, 500]], img);
                        drawLine2(ctx, [[700, 200], [400, 50]]);
                        drawLine(ctx, [[700, 200], [400, 50]], img);
                        drawLine2(ctx, [[400, 500], [700, 200]]);
                        drawLine(ctx, [[400, 500], [700, 200]], img);
                        
                        
                        drawLine2(ctx, [[100, 50], [100, 500]]);
                        drawLine(ctx, [[100, 50], [100, 500]], img);
                        drawLine2(ctx, [[200, 500], [200, 50]]);
                        drawLine(ctx, [[200, 500], [200, 50]], img);
                        
                        drawLine2(ctx, [[700, 50], [900, 50]]);
                        drawLine(ctx, [[700, 50], [900, 50]], img);
                        drawLine2(ctx, [[900, 500], [700, 500]]);
                        drawLine(ctx, [[900, 500], [700, 500]], img);
                    }
                }
            }
            function drawLine2(ctx, line) {
                ctx.beginPath(); //必须加，否则会出现一些不明边框
                ctx.moveTo(line[0][0], line[0][1]);
                ctx.lineTo(line[1][0], line[1][1]);
                ctx.stroke();
            }
            function drawLine(ctx, line, img) {
                let step = 30;
                let start = line[0];
                let end = line[line.length - 1];
                let rotate;
                let offx;
                let offy
                if (start[0] == end[0]) {
                    offx = 0;
                    if (end[1] > start[1]) {
                        rotate = Math.PI / 2; //顺时针旋转90度
                        offy = step / 2
                    } else {
                        rotate = Math.PI * 3 / 2; //顺时针旋转270度
                        offy = -1 * step / 2
                    }
                } else if(start[1] == end[1]){
                    offy = 0;
                    if (end[0] > start[0]) {
                        rotate = 0;
                        offx = step / 2;
                    } else {
                        rotate = Math.PI;   
                        offx = -1 * step / 2;
                    }
                } else {
                    rotate = Math.atan((end[1] - start[1]) / (end[0] - start[0]));
                    offx = Math.cos(rotate) * step / 2;
                    offy = Math.sin(rotate) * step / 2;
                    if (((end[1] - start[1]) < 0 && rotate > 0) || ((end[1] - start[1]) > 0 && rotate < 0)) {
                        console.log('进入到一四象限', rotate / Math.PI);
                        offx = -offx;
                        offy = -offy;
                    }
                }
                console.log(offx, offy, rotate, Math.sin(rotate));
                let x = start[0];
                let y = start[1];
                let l = Math.sqrt(Math.pow(start[1] - end[1], 2) + Math.pow(start[0] - end[0], 2));
                let s = 1;
                //交替旋转180度画出扇区图标
                for (let i = 0; i < l - (step / 2); i += step){
                    let ox = offx * (Math.ceil(i / step * 2) + 1);
                    let oy = offy * (Math.ceil(i / step * 2) + 1);
                    ctx.save();
                    ctx.translate(x + ox, y + oy);
                    ctx.rotate(rotate);
                    ctx.drawImage(img, -step / 2, -step / 2, step, step);
                    ctx.restore();
                    s = -s;
                    rotate += Math.PI * s;
                }
            }
        </script>
    </body>

</html>